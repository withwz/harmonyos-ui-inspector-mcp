# æŠ€æœ¯è°ƒç ”ï¼šé¸¿è’™ UI è°ƒè¯•å·¥å…·åˆ†æ

## å·¥å…·æµ‹è¯•ç»“æœ

### 1. WindowManagerService âœ…

**å‘½ä»¤**: `hidumper -s WindowManagerService -a '-a'`

**è·å–ä¿¡æ¯**:
```
WindowName           DisplayId Pid     WinId Type Mode Flag ZOrd Orientation [ x    y    w    h    ]
rnsurface0           0         31950   61    1    1    0    102  0           [ 0    0    1316 2832 ]
```

**å¯ç”¨æ•°æ®**:
- WindowName - çª—å£åç§°
- Pid - è¿›ç¨‹ ID
- WinId - çª—å£ IDï¼ˆç”¨äºåç»­æŸ¥è¯¢ï¼‰
- Type - çª—å£ç±»å‹
- ZOrd - Z è½´é¡ºåºï¼ˆå±‚çº§ï¼‰
- [x, y, w, h] - ä½ç½®å’Œå°ºå¯¸
- Focus window - å½“å‰ç„¦ç‚¹çª—å£

**ç»„ä»¶æ ‘æŸ¥è¯¢**: `hidumper -s WindowManagerService -a '-w <winId> -element'`
- å¯¹ ArkUI åº”ç”¨æœ‰æ•ˆï¼Œå¯è·å–ç»„ä»¶æ ‘
- å¯¹ RN åº”ç”¨ (rnsurface0) **æ— æ•ˆ**ï¼ˆæ— ç»„ä»¶æ ‘ï¼‰

---

### 2. RenderService âœ…ğŸ”¥ **æ ¸å¿ƒå‘ç°ï¼ˆå®˜æ–¹ç¡®è®¤ï¼‰**

**å‘½ä»¤**: `hidumper -s RenderService -a 'client'`

**å®˜æ–¹æ–‡æ¡£è¯´æ˜** (æ¥æº: OpenHarmony 5.0.3 æ–‡æ¡£):
```
client |dump client ui node trees
```

**è¾“å‡ºç¤ºä¾‹**:
```
ClientNodeTreeDump:
| pid[1937]
  | SurfaceNode[8319351652354], parent[18446744073709551615], name[com.ohos.sceneboardEngineServiceAbility]
    | RootNode[8319351652355], parent[18446744073709551615], frameNodeId[0], frameNodeTag[root]
        | CanvasNode[8319351652356], parent[8319351652355], frameNodeId[1], frameNodeTag[stage]
            | CanvasNode[8319351652357], parent[8319351652356], frameNodeId[2], frameNodeTag[page]
                | ...
```

**å…¶ä»–æœ‰ç”¨çš„ RenderService é€‰é¡¹** (å®˜æ–¹æ–‡æ¡£):
```
RSTree          |dump RSTree info
client-server   |dump client and server info
nodeNotOnTree   |dump nodeNotOnTree info
allInfo         |dump all info
```

**å¯ç”¨æ•°æ®**:
- **å®Œæ•´çš„ UI èŠ‚ç‚¹æ ‘**ï¼ˆåŒ…æ‹¬æ‰€æœ‰åº”ç”¨ï¼ï¼‰
- èŠ‚ç‚¹ç±»å‹ï¼šSurfaceNode, RootNode, CanvasNode ç­‰
- çˆ¶å­å…³ç³»ï¼ˆparent idï¼‰
- frameNodeId, frameNodeTag
- modifiers: BackgroundColor, Bounds, Frame ç­‰å±æ€§

**é‡è¦**: è¿™ä¸ªå‘½ä»¤å¯ä»¥è·å–**æ‰€æœ‰åº”ç”¨**çš„ UI æ ‘ï¼ŒåŒ…æ‹¬ RN åº”ç”¨ï¼

---

### 3. AbilityManagerService âœ…

**å‘½ä»¤**: `hidumper -s AbilityManagerService -a '-a'`
æˆ–: `aa dump --all`

**è¾“å‡ºç¤ºä¾‹**:
```
Mission ID #61  mission name #[#com.example.rnsurface:entry:EntryAbility]
  AbilityRecord ID #222
    app name [com.example.rnsurface]
    bundle name [com.example.rnsurface]
    ability type [PAGE]
    state #FOREGROUND
```

**å¯ç”¨æ•°æ®**:
- åº”ç”¨åˆ—è¡¨
- Bundle åç§°
- Ability çŠ¶æ€ï¼ˆFOREGROUND/BACKGROUNDï¼‰
- Mission ID
- å¯åŠ¨æ—¶é—´

---

### 4. æˆªå›¾åŠŸèƒ½ âœ…

**å‘½ä»¤**:
```bash
hdc shell "snapshot_display -f /data/local/tmp/screenshot.jpeg"
hdc file recv /data/local/tmp/screenshot.jpeg /tmp/screenshot.jpeg
```

**è¾“å‡º**:
```
success: snapshot display 0, write to /data/local/tmp/screenshot.jpeg as jpeg, width: 1316, height: 2832
FileTransfer finish, Size: 189262
```

---

### 5. DisplayManagerService âœ…

**å‘½ä»¤**: `hidumper -s DisplayManagerService -a '-a'`

**å¯ç”¨æ•°æ®**:
- å±å¹•å°ºå¯¸ï¼š1316 x 2832
- åˆ·æ–°ç‡ï¼š60Hz
- DisplayId

---

## ä¸å¯ç”¨å·¥å…·

| å·¥å…· | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| uiautomator | âŒ | Android å·¥å…·ï¼Œé¸¿è’™ä¸æ”¯æŒ |
| AceEngine | âŒ | æœåŠ¡åç§°ä¸æ­£ç¡®æˆ–ä¸å¯ç”¨ |

---

## æ•°æ®è·å–æ–¹æ¡ˆæ€»ç»“

| éœ€æ±‚ | æ•°æ®æº | å‘½ä»¤ |
|------|--------|------|
| çª—å£åˆ—è¡¨ | WindowManagerService | `hidumper -s WindowManagerService -a '-a'` |
| UI ç»„ä»¶æ ‘ | RenderService | `hidumper -s RenderService -a 'client'` |
| åº”ç”¨åˆ—è¡¨ | AbilityManagerService | `hidumper -s AbilityManagerService -a '-a'` |
| æˆªå›¾ | snapshot_display | `snapshot_display -f <path>` |
| å±å¹•ä¿¡æ¯ | DisplayManagerService | `hidumper -s DisplayManagerService -a '-a'` |

---

## å…³é”®å‘ç°

1. **RenderService æ˜¯æ ¸å¿ƒ**ï¼šå¯ä»¥è·å–å®Œæ•´çš„ UI èŠ‚ç‚¹æ ‘ï¼ŒåŒ…æ‹¬ RN åº”ç”¨
2. **è¾“å‡ºæ ¼å¼å¯è§£æ**ï¼šæ ‘çŠ¶ç»“æ„ï¼Œé€šè¿‡ `|` ç¬¦å·è¡¨ç¤ºå±‚çº§
3. **æ€§èƒ½è€ƒè™‘**ï¼šRenderService è¾“å‡ºè¾ƒå¤§ï¼ˆ90KB+ï¼‰ï¼Œéœ€è¦è€ƒè™‘è§£ææ•ˆç‡
4. **æˆªå›¾å¯ç”¨**ï¼šå¯ä»¥ç»“åˆæˆªå›¾è¿›è¡Œè§†è§‰åˆ†æ
